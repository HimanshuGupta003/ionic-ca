<ion-header [translucent]="true">
  <ion-toolbar>
    <ion-title>
      Menu
    </ion-title>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true">
  <ion-header collapse="condense">
    <ion-toolbar>
      <ion-title size="large">Menu</ion-title>
    </ion-toolbar>
  </ion-header>

  <div class="menu-bg">
    <ion-list>
      <ion-card class="menu-card" *ngFor="let f of menu.getMenu()">
        <ion-item lines="none">
          <ion-thumbnail slot="start">
            <ion-img 
              [src]="f.image" 
              [alt]="f.name"
              (ionError)="handleImageError($event)"
            ></ion-img>
          </ion-thumbnail>
          <ion-label>
            <h2 style="margin-bottom:4px; display:flex; align-items:center;">
              <ion-icon [name]="getCategoryIcon(f.category)" style="margin-right:8px; color:var(--ion-color-primary);"></ion-icon>
              {{ f.name }}
            </h2>
            <p style="margin-bottom:8px; color:#555;">{{ f.description }}</p>
            <ion-badge class="price">{{ f.price | currency }}</ion-badge>
          </ion-label>
          
          <!-- Show Add button if not in cart, otherwise show quantity controls -->
          <div class="item-controls">
            <ion-button 
              *ngIf="getItemQuantity(f.id) === 0" 
              fill="solid" 
              color="primary" 
              (click)="addToCart(f.id)"
            >
              Add
            </ion-button>
            
            <div *ngIf="getItemQuantity(f.id) > 0" class="quantity-controls">
              <ion-button size="small" fill="clear" color="danger" (click)="decreaseQuantity(f.id)">
                <ion-icon slot="icon-only" name="remove-circle"></ion-icon>
              </ion-button>
              <span class="quantity">{{ getItemQuantity(f.id) }}</span>
              <ion-button size="small" fill="clear" color="primary" (click)="increaseQuantity(f.id)">
                <ion-icon slot="icon-only" name="add-circle"></ion-icon>
              </ion-button>
            </div>
          </div>
        </ion-item>
      </ion-card>
    </ion-list>

    <!-- Floating Cart Button -->
    <div class="floating-cart" *ngIf="cart.items.length > 0" (click)="goToCart()" [class.cart-pulse]="showAddedFeedback">
      <div class="cart-info">
        <ion-icon name="cart"></ion-icon>
        <span class="cart-count">{{ cart.items.length }} item{{ cart.items.length > 1 ? 's' : '' }}</span>
      </div>
      <div class="cart-total">{{ cart.total | currency }}</div>
    </div>
  </div>
</ion-content>
